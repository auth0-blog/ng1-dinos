(function() {
	'use strict';

	angular
		.module('app')
		.controller('HomeCtrl', HomeCtrl);

	HomeCtrl.$inject = ['$scope', 'Metadata', 'APIData'];

	function HomeCtrl($scope, Metadata, APIData) {
		// controllerAs ViewModel
		var home = this;

		// bindable members
		home.title = 'All Dinosaurs';

		_init();

		/**
		 * INIT function executes procedural code
		 *
		 * @private
		 */
		function _init() {
			// set page <title>
			Metadata.set(home.title);

			// activate controller
			_activate();
		}

		/**
		 * Controller activate
		 * Get JSON data
		 *
		 * @returns {any}
		 * @private
		 */
		function _activate() {
			// start loading
			$scope.$emit('loading-on');

			// get the data from JSON
			return APIData.getAllDinos().then(_getJsonSuccess, _getJsonError);
		}

		/**
		 * Successful promise data
		 *
		 * @param data {json}
		 * @private
		 */
		function _getJsonSuccess(data) {
			home.dinos = data;

			// stop loading
			$scope.$emit('loading-off');

			return home.dinos;
		}

		/**
		 * Failure of promise data
		 */
		function _getJsonError() {
			home.error = true;
		}
	}
}());